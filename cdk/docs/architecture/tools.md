# 開発ツールと手法

## 概要
本ドキュメントは、プロジェクトで使用する開発ツール、ワークフロー、および開発手法を定義します。

## 開発ツールスタック

### バージョン管理

#### Git
- **用途**: ソースコード管理
- **ブランチ戦略**: GitHub Flow
- **コミットメッセージ規約**: Conventional Commits

#### GitHub
- **用途**: リモートリポジトリ、コードレビュー、Issue管理
- **機能**:
  - Pull Request（PR）によるコードレビュー
  - GitHub Issues でのタスク管理
  - GitHub Actions によるCI/CD

### フロントエンド

#### Next.js
- **バージョン**: 15.x以上（App Router）
- **用途**: React フレームワーク
- **主な機能**:
  - サーバーサイドレンダリング（SSR）
  - 静的サイト生成（SSG）
  - App Router によるファイルベースルーティング
  - Server Actions

#### React
- **バージョン**: 19.x以上
- **用途**: UIライブラリ

#### TypeScript
- **用途**: 型安全なJavaScript開発
- **設定**: strict モード有効

#### Tailwind CSS
- **用途**: ユーティリティファーストCSSフレームワーク
- **メリット**: 高速な開発、一貫したデザイン

#### Biome
- **用途**: リンター・フォーマッター（ESLint + Prettier代替）
- **メリット**: 高速、単一ツール

### バックエンド

#### FastAPI
- **バージョン**: 0.128.x以上
- **用途**: Python Webフレームワーク
- **主な機能**:
  - 自動APIドキュメント生成（Swagger UI）
  - Pydantic による型バリデーション
  - 非同期処理サポート

#### Python
- **バージョン**: 3.12以上
- **パッケージ管理**: uv

#### uv
- **用途**: 高速Pythonパッケージ・プロジェクトマネージャー
- **メリット**: pipの10-100倍高速、ロックファイル管理

#### Ruff
- **用途**: リンター・フォーマッター
- **メリット**: Rust製で高速、多機能

#### SQLAlchemy
- **バージョン**: 2.0以上
- **用途**: ORM（Object-Relational Mapping）
- **特徴**: 型ヒント対応、非同期サポート

#### Alembic
- **用途**: データベースマイグレーションツール
- **特徴**: SQLAlchemy統合、自動マイグレーション生成

### データベース

#### PostgreSQL
- **バージョン**: 16
- **ローカル**: Docker（postgres:16-alpine）
- **本番**: Amazon Aurora PostgreSQL

### インフラストラクチャ

#### AWS CDK
- **バージョン**: 2.170.0以上
- **言語**: TypeScript
- **用途**: Infrastructure as Code（IaC）
- **メリット**: プログラマブル、型安全

#### Docker
- **用途**: コンテナ化、開発環境の統一
- **Docker Compose**: マルチコンテナ管理

### CI/CD

#### GitHub Actions
- **用途**: 継続的インテグレーション・デプロイ
- **ワークフロー**:
  - コードプッシュ時の自動テスト
  - Lintチェック
  - Dockerイメージビルド・プッシュ
  - ECSデプロイ

### 開発支援ツール

#### MailHog
- **用途**: ローカル開発でのメール送信テスト
- **ポート**: 1025（SMTP）、8025（Web UI）

#### MinIO
- **用途**: S3互換オブジェクトストレージ
- **ポート**: 9000（API）、9001（Console）

### テストツール

#### pytest（バックエンド）
- **用途**: Pythonテストフレームワーク
- **プラグイン**:
  - pytest-cov: カバレッジ測定
  - pytest-asyncio: 非同期テスト

#### Jest（フロントエンド）
- **用途**: JavaScriptテストフレームワーク
- **統合**: Next.js推奨設定


### エディタ・IDE

#### VSCode（推奨）
- **拡張機能**:
  - Biome: リント・フォーマット
  - Ruff: Pythonリント・フォーマット
  - Python: Python開発サポート
  - Tailwind CSS IntelliSense: CSS補完
  - AWS Toolkit: AWS統合

### コード品質管理

#### Pre-commit
- **用途**: コミット前の自動チェック
- **チェック内容**:
  - コードフォーマット
  - リント
  - 末尾空白削除
  - 大容量ファイルチェック

## 開発ワークフロー

### ブランチ戦略（GitHub Flow）

#### メインブランチ
- **main**: 本番環境にデプロイされるブランチ
  - 常にデプロイ可能な状態を維持
  - 直接コミット禁止

#### フィーチャーブランチ
- **命名規則**: `feature/<issue番号>-<簡潔な説明>`
  - 例: `feature/123-add-user-authentication`
  - 例: `feature/456-fix-login-bug`

#### ワークフロー
1. mainブランチから新しいフィーチャーブランチを作成
2. 開発・コミット
3. Pull Request作成
4. コードレビュー
5. CI（自動テスト、Lint）通過
6. mainブランチにマージ
7. 自動デプロイ

### コミットメッセージ規約（Conventional Commits）

#### フォーマット
```
<type>(<scope>): <subject>

<body>

<footer>
```

#### Type（必須）
- **feat**: 新機能
- **fix**: バグ修正
- **docs**: ドキュメント変更
- **style**: コードフォーマット（機能変更なし）
- **refactor**: リファクタリング
- **perf**: パフォーマンス改善
- **test**: テスト追加・修正
- **chore**: ビルド、ツール設定変更

#### 例
```
feat(auth): ユーザー認証機能を追加

- JWT トークン認証を実装
- ログイン・ログアウトエンドポイント追加
- 認証ミドルウェア実装

Closes #123
```

```
fix(api): ユーザー取得時のNULLエラーを修正

ユーザーが存在しない場合の404レスポンスを追加

Fixes #456
```

### Pull Request（PR）ワークフロー

#### PR作成時
1. **タイトル**: 変更内容を簡潔に記載
2. **説明**:
   - 変更の目的
   - 変更内容の詳細
   - テスト方法
   - スクリーンショット（UI変更時）
3. **レビュアー指定**: 最低1名
4. **ラベル付与**: feature、bug、documentation等

#### PRテンプレート
```markdown
## 概要
<!-- 変更の目的を記載 -->

## 変更内容
<!-- 主な変更点を箇条書き -->
-
-

## テスト方法
<!-- 動作確認手順を記載 -->
1.
2.

## スクリーンショット（UI変更時）
<!-- ビフォー・アフターの画像 -->

## チェックリスト
- [ ] テストを追加・更新した
- [ ] ドキュメントを更新した
- [ ] Lintエラーがない
- [ ] CI が通過している

## 関連Issue
Closes #<issue番号>
```

#### コードレビュー観点
- **機能性**: 要件を満たしているか
- **コード品質**: 可読性、保守性
- **テスト**: 適切なテストが書かれているか
- **セキュリティ**: 脆弱性がないか
- **パフォーマンス**: 非効率な処理がないか

### Issue管理

#### Issue作成
- **タイトル**: 問題や要望を簡潔に
- **説明**:
  - 背景・目的
  - 具体的な内容
  - 受け入れ条件
- **ラベル**: bug、enhancement、documentation等
- **担当者**: アサイン

#### Issueテンプレート（機能追加）
```markdown
## 背景・目的
<!-- なぜこの機能が必要か -->

## 機能概要
<!-- 実装する機能の説明 -->

## 受け入れ条件
<!-- 完了の定義 -->
- [ ]
- [ ]

## 補足
<!-- 参考資料、設計メモ等 -->
```

#### Issueテンプレート（バグ報告）
```markdown
## 現象
<!-- 発生している問題 -->

## 再現手順
1.
2.
3.

## 期待される動作
<!-- 本来どうあるべきか -->

## 環境
- OS:
- ブラウザ:
- バージョン:

## スクリーンショット・ログ
<!-- エラーメッセージ、画像等 -->
```

## CI/CDパイプライン

### GitHub Actionsワークフロー

#### バックエンドCI
- **トリガー**: main ブランチへのプッシュ、Pull Request
- **対象**: backend/ ディレクトリの変更
- **処理内容**:
  - 依存関係インストール（uv）
  - リントチェック（Ruff）
  - フォーマットチェック（Ruff）
  - ユニットテスト実行（pytest）
  - カバレッジ測定・アップロード

#### フロントエンドCI
- **トリガー**: main ブランチへのプッシュ、Pull Request
- **対象**: frontend/ ディレクトリの変更
- **処理内容**:
  - 依存関係インストール（npm）
  - リントチェック（Biome）
  - ユニットテスト実行（Jest）
  - ビルド確認

#### デプロイワークフロー
- **トリガー**: main ブランチへのプッシュ
- **バックエンド**:
  - AWS認証情報設定
  - ECRログイン
  - Dockerイメージビルド・プッシュ
  - ECSサービス更新（強制デプロイ）
- **フロントエンド**:
  - AWS Amplify自動デプロイ（GitHub連携）

#### CDKデプロイワークフロー
- **トリガー**: main ブランチへのプッシュ（cdk/ ディレクトリ変更時）
- **処理内容**:
  - 依存関係インストール
  - CDK差分確認
  - CDKスタックデプロイ

## テスト戦略

### テストピラミッド
```
        ┌─────────────┐
        │Integration  │  中程度（API統合テスト）
        │   Tests     │
        ├─────────────┤
        │   Unit      │  多数（関数・コンポーネント単位）
        │   Tests     │
        └─────────────┘
```

### バックエンドテスト

#### ユニットテスト
- **対象**: サービス層、ユーティリティ関数
- **ツール**: pytest
- **目的**: ビジネスロジックの検証

#### 統合テスト
- **対象**: APIエンドポイント
- **ツール**: pytest + FastAPI TestClient
- **目的**: API全体の動作確認

### フロントエンドテスト

#### ユニットテスト（コンポーネント）
- **対象**: Reactコンポーネント
- **ツール**: Jest + React Testing Library
- **目的**: コンポーネントの表示・動作確認

### テストカバレッジ目標
- **ユニットテスト**: 80%以上
- **統合テスト**: 主要APIエンドポイント全て

## セキュリティベストプラクティス

### コードレベル
- **環境変数**: 秘密情報は環境変数で管理（`.env`ファイルを`.gitignore`）
- **入力バリデーション**: 厳格なバリデーション実施
- **SQLインジェクション対策**: ORMの使用
- **XSS対策**: フレームワークの自動エスケープ機能を活用
- **CSRF対策**: トークンベース認証

### 依存関係管理
- **定期的な更新**: Dependabotによる自動PR作成
- **脆弱性スキャン**: GitHub Security Alerts
- **ロックファイル**: uv.lock、package-lock.jsonでバージョン固定

### AWS セキュリティ
- **最小権限の原則**: IAMロールで必要最小限の権限
- **シークレット管理**: AWS Secrets Manager
- **暗号化**: S3、RDS の保存時暗号化
- **ネットワーク**: プライベートサブネット、セキュリティグループ

## パフォーマンス監視

### メトリクス
- **CloudWatch**: CPU、メモリ、リクエスト数、エラー率
- **アプリケーションログ**: 構造化ログ（JSON形式）
- **分散トレーシング**: AWS X-Ray（オプション）

### アラート設定
- CPU使用率 > 80%
- メモリ使用率 > 80%
- 5xxエラー率 > 5%
- レスポンスタイム > 1秒

## ドキュメント管理

### コードドキュメント
- **Python**: Docstrings
- **TypeScript**: JSDoc コメント
- **API**: 自動生成されたAPIドキュメント（Swagger UI）

### プロジェクトドキュメント
- **README.md**: プロジェクト概要、セットアップ手順
- **docs/architecture/**: 技術仕様書、アーキテクチャ設計書
- **.steering/**: 作業単位のドキュメント（要件、設計、タスクリスト）

## 更新履歴
- 2026-01-19: 初版作成
